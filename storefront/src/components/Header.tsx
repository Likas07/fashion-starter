import * as React from "react"
import { listRegions } from "@lib/data/regions"
import { getProductTypesList } from "@lib/data/product-types"
import { slugify } from "@lib/util/slugify"
import { SearchField } from "@/components/SearchField"
import { Layout, LayoutColumn } from "@/components/Layout"
import { LocalizedLink } from "@/components/LocalizedLink"
import { HeaderDrawer } from "@/components/HeaderDrawer"
import { RegionSwitcher } from "@/components/RegionSwitcher"
import { HeaderWrapper } from "@/components/HeaderWrapper"

import dynamic from "next/dynamic"

const LoginLink = dynamic(
  () => import("@modules/header/components/LoginLink"),
  { loading: () => <></> }
)

const CartDrawer = dynamic(
  () => import("@/components/CartDrawer").then((mod) => mod.CartDrawer),
  { loading: () => <></> }
)

export const Header: React.FC = async () => {
  const regions = await listRegions()
  const { productTypes } = await getProductTypesList(0, 100, ["value"])

  const countryOptions = regions
    .map((r) => {
      return (r.countries ?? []).map((c) => ({
        country: c.iso_2,
        region: r.id,
        label: c.display_name,
      }))
    })
    .flat()
    .sort((a, b) => (a?.label ?? "").localeCompare(b?.label ?? ""))

  return (
    <>
      <HeaderWrapper>
        <Layout>
          <LayoutColumn>
            <div className="flex justify-between items-center h-18 md:h-21">
              <h1 className="font-medium text-md text-header-text">
                <LocalizedLink href="/">
                  <svg
                    version="1.1"
                    xmlns="http://www.w3.org/2000/svg"
                    height="70"
                    viewBox="0 0 923 827"
                  >
                    <path
                      d="M0 0 C45.57731392 21.57271023 90.34261212 32.74103973 139.45916748 15.48648071 C152.88021429 10.52323615 164.96402371 2.76911416 177.02166748 -4.82601929 C195.87256662 -16.51066166 214.47088098 -20.744812 236.58416748 -20.76351929 C237.6565567 -20.7645314 237.6565567 -20.7645314 238.75061035 -20.76556396 C268.69468928 -20.72064575 291.29488737 -10.20820804 315.92449951 6.02261353 C334.73377451 18.41334226 356.7323961 26.00860734 379.44354248 25.44351196 C380.99431134 25.42115126 382.54509343 25.39969292 384.09588623 25.37905884 C386.50787707 25.3418261 388.91918117 25.29843198 391.33074951 25.23965454 C393.68094934 25.18521435 396.03037062 25.15610984 398.38104248 25.13101196 C399.46080353 25.09533867 399.46080353 25.09533867 400.56237793 25.0589447 C404.00269818 25.04094344 405.82857955 25.2510825 408.62884521 27.32339478 C410.14666748 29.48648071 410.14666748 29.48648071 410.19744873 32.45132446 C408.09850441 38.51407442 402.14701799 41.8059832 397.14666748 45.48648071 C396.3978833 46.05511841 395.64909912 46.6237561 394.87762451 47.20962524 C385.23489467 54.44606011 377.39926393 60.29321324 364.93572998 59.11929321 C363.68533936 58.91046509 362.43494873 58.70163696 361.14666748 58.48648071 C359.30201904 58.23511353 359.30201904 58.23511353 357.42010498 57.97866821 C338.52616723 54.83630804 322.12266365 46.49650651 305.87371826 36.7460022 C276.4705094 19.12798193 244.43630637 9.71235939 210.00994873 17.45913696 C193.76918541 21.77796482 179.68085766 29.72041939 165.52166748 38.61148071 C132.7433963 58.99495337 91.94214051 66.03948836 54.14666748 57.48648071 C33.54521673 52.62647548 14.27221781 43.55301755 -4.66583252 34.29898071 C-36.20753162 18.89942766 -67.8941311 9.12890483 -102.47833252 20.54898071 C-115.24069155 25.35108869 -127.45816359 31.5907966 -139.41583252 38.11148071 C-171.45821051 55.42727289 -211.05889263 66.95847691 -247.00714111 56.97720337 C-248.61226534 56.55055702 -250.24202562 56.21880248 -251.87286377 55.90444946 C-259.51752588 54.27217906 -263.32665446 49.54492152 -267.85333252 43.48648071 C-268.72272461 42.33478394 -268.72272461 42.33478394 -269.60968018 41.15982056 C-271.57061575 38.53642698 -273.49864532 35.89199201 -275.41583252 33.23648071 C-276.04843994 32.3728894 -276.68104736 31.5092981 -277.33282471 30.61953735 C-281.71761592 24.38321556 -281.71761592 24.38321556 -282.38067627 20.00210571 C-281.85333252 17.48648071 -281.85333252 17.48648071 -279.85333252 15.48648071 C-274.60640066 15.04226194 -270.69293198 15.9906981 -265.79083252 17.79898071 C-236.34578689 28.237816 -204.54119831 25.95453411 -174.79083252 17.73648071 C-174.0443042 17.53329224 -173.29777588 17.33010376 -172.52862549 17.12075806 C-155.72993346 12.08656356 -140.07428853 3.14603105 -124.65875244 -5.03085327 C-80.28861137 -28.51227121 -43.61123112 -20.64386463 0 0 Z "
                      fill="#FEFEFE"
                      transform="translate(454.85333251953125,618.5135192871094)"
                    />
                    <path
                      d="M0 0 C0.88945313 0.77730469 1.77890625 1.55460937 2.6953125 2.35546875 C9.23473899 8.21486941 15.49062274 14.36453612 21.72268677 20.54745483 C23.1444053 21.95726623 24.57006788 23.36309679 25.99584961 24.76879883 C32.10286175 30.86817788 37.62251363 37.25470663 43 44 C43.86349653 45.02745904 44.73189014 46.05086764 45.609375 47.06640625 C96.6860809 106.62482791 126.51286246 185.27808241 133 263 C133.11214844 264.27488281 133.22429688 265.54976563 133.33984375 266.86328125 C134.04267276 276.4429369 134.10295269 286.02325515 134.125 295.625 C134.12967285 296.91116211 134.1343457 298.19732422 134.13916016 299.52246094 C134.13281493 303.35009773 134.0786131 307.17319192 134 311 C133.99206421 311.67687866 133.98412842 312.35375732 133.97595215 313.05114746 C133.94492755 315.0852353 133.87932147 317.11553099 133.8046875 319.1484375 C133.77101074 320.34388184 133.73733398 321.53932617 133.70263672 322.77099609 C132.56571922 327.99576012 128.7757675 330.64166489 124.5546875 333.60546875 C123.95269531 334.03150391 123.35070312 334.45753906 122.73046875 334.89648438 C122.11816406 335.32251953 121.50585938 335.74855469 120.875 336.1875 C120.25496094 336.62513672 119.63492188 337.06277344 118.99609375 337.51367188 C110.53185542 343.47504403 110.53185542 343.47504403 104 343 C102 341 102 341 101.75195312 339.13354492 C101.8308673 332.82895999 102.39008718 326.6367612 103.06787109 320.36987305 C112.98587981 228.4801262 86.62617778 137.74605165 28.83203125 65.48828125 C16.33550969 50.02604501 3.06364611 35.00832997 -12 22 C-12.73605469 21.31421875 -13.47210937 20.6284375 -14.23046875 19.921875 C-21.32833333 13.31146846 -28.97163284 7.48382013 -36.73681641 1.68945312 C-38.21889044 0.58309365 -39.69786352 -0.52743493 -41.17333984 -1.64257812 C-90.96896201 -39.21820765 -152.16194365 -63.31702326 -214 -71 C-214.68212555 -71.08613556 -215.3642511 -71.17227112 -216.06704712 -71.26101685 C-230.40428634 -73.02447059 -244.62820115 -73.36240596 -259.0625 -73.3125 C-260.18684448 -73.31034485 -261.31118896 -73.3081897 -262.46960449 -73.30596924 C-279.17099814 -73.25463968 -295.50183932 -72.81427216 -312 -70 C-313.18722656 -69.80664062 -314.37445313 -69.61328125 -315.59765625 -69.4140625 C-347.78217385 -64.06648111 -379.65956266 -55.17437685 -408.953125 -40.59765625 C-410.07541504 -40.03925049 -411.19770508 -39.48084473 -412.35400391 -38.90551758 C-414.46817869 -37.83549077 -416.57058356 -36.74173552 -418.65771484 -35.61987305 C-424.4039513 -32.66982672 -428.50288309 -31.44812729 -434.95605469 -32.29760742 C-437.37691843 -33.12952632 -438.20053115 -33.9627435 -439.625 -36.0625 C-440.07875 -37.031875 -440.5325 -38.00125 -441 -39 C-440.525625 -39.78375 -440.05125 -40.5675 -439.5625 -41.375 C-437.97124005 -45.06672309 -438.05538053 -46.08833145 -438.3125 -49.875 C-438.0859375 -52.4921875 -438.0859375 -52.4921875 -437 -55 C-432.85286618 -58.09574778 -428.34449656 -59.98779757 -423.57226562 -61.94189453 C-420.87599978 -63.05100768 -418.21254356 -64.22171296 -415.546875 -65.40234375 C-313.2041579 -110.10087011 -194.20743176 -107.4222682 0 0 Z "
                      fill="#FEFEFE"
                      transform="translate(779,128)"
                    />
                    <path
                      d="M0 0 C45.01619675 21.37021599 89.33853303 32.25248351 138.0078125 15.609375 C150.61022821 10.87513418 162.23131934 4.20870988 173.52954102 -3.06494141 C202.21443369 -21.51456692 235.18795033 -25.26393041 268.38671875 -18.15234375 C276.48076537 -16.14348557 285.93657572 -13.61637469 292.38671875 -8.15234375 C293.69921875 -5.08984375 293.69921875 -5.08984375 293.38671875 -2.15234375 C290.15619282 1.87338856 285.91384285 4.00568212 281.44921875 6.41015625 C280.65346436 6.84287842 279.85770996 7.27560059 279.0378418 7.72143555 C277.34287018 8.64004654 275.64595767 9.55508404 273.94726562 10.46679688 C271.4948415 11.78934749 269.05749846 13.13650848 266.62109375 14.48828125 C211.85896093 44.47733083 146.32150513 61.79202226 83.95703125 62.05078125 C82.81598434 62.05779556 81.67493744 62.06480988 80.49931335 62.07203674 C76.83674115 62.08943809 73.17433078 62.09588923 69.51171875 62.09765625 C67.63206924 62.09866837 67.63206924 62.09866837 65.71444702 62.09970093 C46.75423099 62.08348175 28.17172058 61.62409848 9.38671875 58.84765625 C8.19836426 58.6760498 7.01000977 58.50444336 5.78564453 58.32763672 C-39.47585169 51.60063257 -100.48000626 38.47621342 -137.61328125 9.84765625 C-138.73828125 6.84765625 -138.73828125 6.84765625 -138.61328125 3.84765625 C-134.42577283 -1.13040705 -128.67184681 -3.59004947 -122.98828125 -6.52734375 C-121.86905273 -7.10589111 -120.74982422 -7.68443848 -119.59667969 -8.28051758 C-77.04758904 -29.81376625 -40.7525575 -19.43691562 0 0 Z "
                      fill="#FEFEFE"
                      transform="translate(442.61328125,752.15234375)"
                    />
                    <path
                      d="M0 0 C2.81485619 2.48369664 3.93119986 4.29359959 5.125 7.875 C5.34008399 12.59824453 4.7933239 15.87839959 2.12890625 19.8515625 C-0.97294399 25.07488544 -0.64090293 30.89117378 -0.875 36.8125 C-3.13916873 76.61230062 -14.38055977 115.35953437 -30.83105469 151.57275391 C-31.82454012 153.76371921 -32.79280518 155.96434855 -33.7578125 158.16796875 C-42.50728052 177.79907011 -53.99913514 196.45848382 -67.875 212.875 C-69.875 211.875 -69.875 211.875 -70.8828125 208.875 C-71.25764192 207.54234876 -71.62983833 206.20895531 -72 204.875 C-76.23810825 190.62540926 -82.37587947 178.34563611 -91.875 166.875 C-92.35195312 166.235625 -92.82890625 165.59625 -93.3203125 164.9375 C-107.56136085 146.51794045 -134.44475877 135.79323855 -156.875 132.875 C-161.6021534 132.52964803 -166.32489583 132.3725903 -171.0625 132.25 C-172.9197168 132.19199219 -172.9197168 132.19199219 -174.81445312 132.1328125 C-177.83449626 132.03952931 -180.8545486 131.95373594 -183.875 131.875 C-159.39981966 93.30752081 -159.39981966 93.30752081 -143.875 76.875 C-142.72370242 75.54638204 -141.57770122 74.21315282 -140.4375 72.875 C-132.9634238 64.33565317 -124.78717985 56.87999735 -115.875 49.875 C-114.36099609 48.65296875 -114.36099609 48.65296875 -112.81640625 47.40625 C-91.71185395 30.54739101 -66.53747638 18.92831411 -40.6875 11.4375 C-39.83905518 11.1904834 -38.99061035 10.9434668 -38.11645508 10.68896484 C-33.2661016 9.34475824 -28.732844 8.55642934 -23.6940918 8.39428711 C-21.68104706 8.04755811 -21.68104706 8.04755811 -20.77661133 5.97485352 C-20.47907959 5.28190186 -20.18154785 4.5889502 -19.875 3.875 C-14.02583615 -1.3742496 -7.44073448 -2.91159175 0 0 Z "
                      fill="#FEFEFE"
                      transform="translate(326.875,70.125)"
                    />
                    <path
                      d="M0 0 C0.3125 3.3125 0.3125 3.3125 0 7 C-4.15677005 10.36899508 -9.2401586 11.25916713 -14.3125 12.5625 C-71.79317407 28.25239078 -118.84654687 69.13912968 -148.71875 119.921875 C-149.8435487 121.9340149 -150.94481229 123.9507144 -152 126 C-155 125 -155 125 -156.76171875 121.75390625 C-157.40903984 120.35926179 -158.05062863 118.96194725 -158.6875 117.5625 C-162.03873326 110.5649952 -165.78878181 104.79024243 -171 99 C-171.82242188 98.03578125 -172.64484375 97.0715625 -173.4921875 96.078125 C-184.13224762 83.78816974 -196.15849828 75.52265495 -211 69 C-212.07773682 68.52602783 -212.07773682 68.52602783 -213.17724609 68.04248047 C-230.31538185 60.65319807 -246.33104988 57.20557659 -265 58 C-255.32655927 30.65100526 -222.99057368 9.75661853 -198.2578125 -2.0625 C-175.91073554 -12.39712242 -151.40000001 -18.20550274 -127 -21 C-125.92238403 -21.13921875 -125.92238403 -21.13921875 -124.82299805 -21.28125 C-83.25470645 -26.18244871 -36.56424026 -21.14005203 0 0 Z "
                      fill="#FEFEFE"
                      transform="translate(291,68)"
                    />
                    <path
                      d="M0 0 C43.73266233 20.72059643 87.95101174 31.93769482 135.30419922 15.59399414 C148.15729725 10.91396176 159.88437452 4.1145819 171.47705078 -3.06640625 C199.95537912 -20.63092049 232.22714228 -26.75866359 265.33837891 -18.93310547 C281.68752127 -14.81308886 295.39222898 -7.13038579 309.35205078 2.12109375 C338.45074829 21.39042813 372.48476198 30.26795063 407.28955078 23.55859375 C422.14816493 20.04365277 435.25437235 13.5978047 447.25439453 4.18359375 C451.09628391 2.12667486 453.14536194 2.41957743 457.28955078 3.55859375 C460.09031654 9.16012527 458.01431158 16.77077185 456.18017578 22.40234375 C452.29110379 28.8948441 445.08636393 30.95372757 438.28955078 33.55859375 C436.92815239 34.11542722 435.56745379 34.67397522 434.20751953 35.234375 C417.82570363 41.81554966 400.93489752 45.95858687 383.22705078 45.87109375 C381.45140747 45.86372192 381.45140747 45.86372192 379.63989258 45.85620117 C348.13192241 45.43866436 323.74383636 33.00667593 297.75439453 16.2890625 C279.11441625 4.44373001 259.90309547 -0.62081207 237.91357422 -0.68164062 C235.82233478 -0.69125552 233.73211921 -0.72229917 231.64111328 -0.75390625 C207.15863605 -0.94664326 186.78999976 8.38462347 166.35205078 21.05859375 C132.82713884 41.73548636 92.69250847 50.21684555 53.72705078 41.59375 C34.5409477 37.01325673 16.91140886 29.01715724 -0.81072998 20.55905151 C-17.91380603 12.40433987 -35.1336091 4.67588813 -53.71044922 0.55859375 C-54.48598145 0.38497314 -55.26151367 0.21135254 -56.06054688 0.0324707 C-85.16984701 -5.1730896 -108.90364349 6.37400015 -133.83740234 19.4230957 C-142.03343733 23.70921703 -150.224485 27.8740361 -158.71044922 31.55859375 C-159.72751953 32.00332031 -160.74458984 32.44804688 -161.79248047 32.90625 C-168.29769727 35.58198069 -174.90473748 37.51703019 -181.71044922 39.24609375 C-182.50475342 39.4486377 -183.29905762 39.65118164 -184.11743164 39.85986328 C-196.07343154 42.76968646 -207.7861044 43.97178417 -220.08544922 43.93359375 C-221.13008835 43.93227951 -221.13008835 43.93227951 -222.1958313 43.93093872 C-235.02392785 43.8781151 -247.22756189 42.57850727 -259.71044922 39.55859375 C-260.6949707 39.32253418 -261.67949219 39.08647461 -262.69384766 38.84326172 C-274.99881172 35.8090806 -286.92774896 31.93270573 -298.77294922 27.43359375 C-299.84907471 27.02608887 -300.9252002 26.61858398 -302.03393555 26.19873047 C-316.79413892 20.4104612 -316.79413892 20.4104612 -320.36669922 15.09375 C-323.46908548 6.00203471 -323.46908548 6.00203471 -322.71044922 1.55859375 C-321.58544922 -0.37890625 -321.58544922 -0.37890625 -319.71044922 -1.44140625 C-313.92530181 -1.10215378 -309.39312882 1.54477292 -304.33544922 4.12109375 C-262.74862876 24.57568114 -215.33131835 30.11347097 -170.95019531 15.34960938 C-155.66454742 9.95114642 -141.35059828 2.44974167 -127.05029297 -5.109375 C-81.09548401 -29.34393403 -45.20868481 -21.47080994 0 0 Z "
                      fill="#FEFEFE"
                      transform="translate(452.71044921875,493.44140625)"
                    />
                    <path
                      d="M0 0 C4.48527779 0.17315518 6.53604507 0.59243061 9.95703125 3.59765625 C10.93079758 4.73416436 11.88165904 5.89057566 12.8125 7.0625 C13.32458008 7.68592285 13.83666016 8.3093457 14.36425781 8.95166016 C19.92337591 15.88248634 24.62436537 23.27940223 29 31 C29.35545898 31.62036133 29.71091797 32.24072266 30.07714844 32.87988281 C38.61480784 48.03923862 43.70290354 64.91556644 47.8125 81.75 C48.08646606 82.86121216 48.08646606 82.86121216 48.3659668 83.99487305 C52.10696403 100.28765039 53.55373546 116.43997896 53.4375 133.125 C53.43445862 134.05921783 53.43141724 134.99343567 53.42828369 135.95596313 C53.35476947 151.29576664 52.33660395 165.98149921 49 181 C48.78037598 182.01497559 48.56075195 183.02995117 48.33447266 184.07568359 C43.44294432 206.22084052 35.69767567 226.54245241 26 247 C24 246 24 246 22.9921875 243.33203125 C22.62351562 242.17058594 22.25484375 241.00914062 21.875 239.8125 C13.60226127 215.3940699 -4.66422652 197.63866492 -26.83984375 185.4375 C-33.94176881 181.93346649 -41.25046624 180.42684166 -49 179 C-50.95885461 178.60675441 -52.91725806 178.211248 -54.875 177.8125 C-56.24979641 177.54063511 -57.62470947 177.26935414 -59 177 C-60.52666207 171.20613125 -60.52666207 171.20613125 -59.21240234 168.19628906 C-57.94787788 166.26914322 -56.59736403 164.44854358 -55.1875 162.625 C-54.15324886 161.19972733 -53.12341013 159.77124397 -52.09765625 158.33984375 C-51.57445801 157.61522949 -51.05125977 156.89061523 -50.51220703 156.14404297 C-21.06809597 114.39748446 -7.15157835 60.47435652 -3.77050781 10.13891602 C-3.43651899 5.9103467 -3.04306591 3.08429987 0 0 Z "
                      fill="#FEFEFE"
                      transform="translate(333,105)"
                    />
                    <path
                      d="M0 0 C4.42348853 0.44234885 6.39873151 1.49135037 9.75 4.375 C11.07519531 6.70117188 11.07519531 6.70117188 11.75 9.375 C10.83496094 11.86523437 10.83496094 11.86523437 9.234375 14.46875 C8.66654297 15.43296875 8.09871094 16.3971875 7.51367188 17.390625 C6.93166016 18.37546875 6.34964844 19.3603125 5.75 20.375 C-27.57686738 83.92236896 -40.03425601 158.39652341 -36.953125 229.7265625 C-36.9001123 230.95745605 -36.84709961 232.18834961 -36.79248047 233.45654297 C-36.68252709 235.86493865 -36.5620958 238.2728834 -36.43017578 240.68017578 C-36.37845215 241.77056152 -36.32672852 242.86094727 -36.2734375 243.984375 C-36.22106934 244.95342773 -36.16870117 245.92248047 -36.11474609 246.92089844 C-36.25 249.375 -36.25 249.375 -38.25 252.375 C-44.33146305 253.17128913 -49.07616487 251.33403988 -54.5625 249 C-55.37267578 248.70222656 -56.18285156 248.40445313 -57.01757812 248.09765625 C-59.45413697 247.06298097 -61.22822393 246.08599836 -63.25 244.375 C-65.63993781 238.1400631 -65.55667927 231.02341819 -65.55078125 224.42578125 C-65.55638062 223.50290314 -65.56197998 222.58002502 -65.56774902 221.62918091 C-65.57960889 218.64845238 -65.57339982 215.6682277 -65.5625 212.6875 C-65.56067719 211.66367218 -65.55885437 210.63984436 -65.55697632 209.58499146 C-65.50438482 192.01686092 -64.69499951 174.79321502 -62.25 157.375 C-62.08371094 156.1880957 -61.91742188 155.00119141 -61.74609375 153.77832031 C-57.68059499 125.91459637 -24.8630008 2.86880778 0 0 Z "
                      fill="#FEFEFE"
                      transform="translate(190.25,214.625)"
                    />
                  </svg>
                </LocalizedLink>
              </h1>
              <div className="flex items-center gap-8 max-md:hidden">
                {productTypes &&
                  productTypes.map((pt) => (
                    <LocalizedLink
                      key={pt.id}
                      href={`/store/${slugify(pt.value)}`}
                      className="text-header-text"
                    >
                      {pt.value}
                    </LocalizedLink>
                  ))}
                <LocalizedLink href="/store" className="text-header-text">
                  Todos
                </LocalizedLink>
              </div>
              <div className="flex items-center gap-3 lg:gap-6 max-md:hidden">
                <RegionSwitcher
                  countryOptions={countryOptions}
                  className="w-16"
                  selectButtonClassName="h-auto !gap-0 !p-1 transition-none text-header-text"
                  selectIconClassName="text-header-text"
                />
                <React.Suspense>
                  <SearchField countryOptions={countryOptions} />
                </React.Suspense>
                <LoginLink className="p-1 text-header-text font-semibold text-lg" />
                <CartDrawer />
              </div>
              <div className="flex items-center gap-4 md:hidden">
                <LoginLink className="p-1 text-header-text font-semibold text-lg" />
                <CartDrawer />
                <React.Suspense>
                  <HeaderDrawer countryOptions={countryOptions} />
                </React.Suspense>
              </div>
            </div>
          </LayoutColumn>
        </Layout>
      </HeaderWrapper>
    </>
  )
}
